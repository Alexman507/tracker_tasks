# Tracker tasks

Серверное приложение для работы с базой данных, представляющее собой трекер задач сотрудников.

Обеспечивает CRUD операции для сотрудников и задач, а также предоставляет специальные эндпоинты для получения информации
о загруженности сотрудников и важных задачах.
Трекер задач позволит компании эффективно управлять заданиями, назначенными сотрудникам, и обеспечивать прозрачность
процессов выполнения задач. Это поможет в равномерном распределении нагрузки между сотрудниками и своевременном
выполнении ключевых задач.

## Стек для основного функционала:

* Python 3.11;
* Django 4.1;
* DRF 3.15.2;
* PostgreSQL 16;
* Django ORM;
* Git;
* Docker;
* Docker-Compose;
* Coverage,
* Swagger.

## Прочие инструменты и сервисы:

* CORS,
* Simple JWT,
* Django-filter,
* Django-pghistory,
* Django-phonenumber-field.

## Запланированные доработки:

* Воркеры Celery и Celery-beat для оповещений на почту,
* Интеграция с Telegram API,
* Доп. эндпоинт для вывода истории задач (прогресс-бар),
* Фронтенд (скорее всего, в отдельном проекте).

## Документация

**Содержание:**

- [Описание эндпоинтов](#Описание_эндпоинтов)
- [Описание_данных](#Описание_данных)
- [Описание эндпоинтов для Пользователей](#Описание_эндпоинтов_для_Пользователей)
- [Описание_эндпоинтов для Трекера задач](#Описание_эндпоинтов_для_Трекера_задач)
- [Примеры](#Примеры)
- [Запуск проекта](#Запуск_проекта)

### "URL-паттерны"

* admin/
* tasker/
* users/
* swagger/ [name='schema-swagger-ui']
* redoc/ [name='schema-redoc']


### Валидация
* поле email - ограничение по домену компании (настраивается в файле /users/models.py)
* поле deadline - ограничение, нельзя создать задачу в прошедшем времени (/tasker/validators.py)

### Описание эндпоинтов 
<a name="Описание_эндпоинтов"></a>

> Обязательные поля при создании моделей:
> * User
>   * first_name: Имя
>   * last_name: Фамилия
>   * position Должность
>   * email: email
>   * password: пароль
> * Task
>   * name: Наименование
>   * status: Статус (список)

**Табл. 1. "Эндпоинты для сотрудников (доступны минимум после аутентификации, кроме получения и обновления токена)"**

| Тип запроса   | Эндпоинт              | Описание                                                                                                                                                                                                                                 |
|---------------|-----------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| GET           | /users/               | Возвращает список должностей                                                                                                                                                                                                             |
| GET           | /users/<id_user>/     | Возвращает должность по id                                                                                                                                                                                                               |
| POST          | /users/               | Создать сотрудника, возвращает созданного сотрудника                                                                                                                                                                                     |
| PUT или PATCH | /users/<id_user>/     | Изменить сотрудника по id                                                                                                                                                                                                                |
| DELETE        | /users/<id_user>/     | Удалить должность по id                                                                                                                                                                                                                  |
| POST          | /users/login/         | Получить токен доступа JWT при запросах (обязательные поля "email" и "password")                                                                                                                                                         |
| POST          | /users/token/refresh/ | Обновить токен доступа JWT                                                                                                                                                                                                               |
| GET           | /users/busy/          | Запрашивает из БД список сотрудников и их задачи, отсортированный по количеству активных задач                                                                                                                                           |
| GET           | /users/free/          | Реализует поиск по сотрудникам, которые могут взять важную задачу (наименее загруженный сотрудник или сотрудник выполняющий родительскую задачу, если ему назначено максимум на 2 задачи больше, чем у наименее загруженного сотрудника) |

> **Примечание:** Для формирования структур тела запроса для типов POST, PUT, PATCH \
> посмотрите раздел сгенерированной авто-документации по пути swagger/ или redoc/

**Табл. 2. "Описание для задач"**

| Тип запроса   | Эндпоинт           | Описание                                                                                                   |
|---------------|--------------------|------------------------------------------------------------------------------------------------------------|
| GET           | /tasker/           | Возвращает список задач                                                                                    |
| GET           | /tasker/           | Возвращает задачу по id                                                                                    |
| POST          | /tasker/           | Создать задачу, возвращает созданную задачу                                                                |
| PUT или PATCH | /tasker/<id_task>/ | Изменить задачу по id                                                                                      |
| DELETE        | /tasker/<id_task>/ | Удалить задачу по id                                                                                       |
| GET           | /tasker/public/    | Запрашивает из БД приоритетные задачи, назначенные сотруднику                                              |
| GET           | /tasker/free/      | Запрашивает из БД задачи, которые не взяты в работу, но от которых зависят другие задачи, взятые в работу. |
| GET           | /tasker/list/      | Возвращает список объектов в формате: `{Важная задача, Срок, [ФИО сотрудника]}`                            |

> **Примечание:** Для формирования структур тела запроса для типов POST, PUT, PATCH \
> посмотрите раздел сгенерированной авто-документации по пути swagger/ или redoc/


<!--Установка-->

## Установка (Linux)
* Клонируем проект на свой репозиторий
* Создаём пару ключей командой для pull с репозитория ssh-keygen
* Вам нужно полностью скопировать содержимое файла id_rsa.pub и добавить в свой git в разделе settings -> SSH and GPG keys (если в гитхаб копируете)
* Пулим проект командой `git pull`
* Прописать в config/settings.py адрес сервера в ALLOWED_HOSTS = [<адрес сервера>] - если ip-статический, если динамический, придётся при перезагрузке подменять ip, либо разрешить все значком "*" (небезопасно)
* Переименовать файл .env.example в .env и прописать невыставленные свои настройки. Получить секретный ключ можно встроенной командой джанго:

```
from django.core.management.utils import get_random_secret_key

get_random_secret_key()
```
* Перед разворачиванием контейнера можно изменить email и пароль суперпользователя ./users/management/commands/csu.py
* Если на сервере ещё не установлен Docker и Docker-compose, команда `apt install docker docker-compose`
* Запустить скрипт в корне проекта ./deploy.sh или с указанием полного пути до скрипта, например /home/user/deploy.sh
* Если выдало ошибку прав доступа, нужно добавить права исполняемости ```chmod ugo+x deploy.sh```
* В Postman можно заполнить во вкладке headers "Autorization" = Bearer [ваш_токен_без_кавычек] Токен можно получить по адресу <ip-адрес>/users/login/
* Или можно загрузить фикстуры в корне проекта ./fixtures

```docker exec -it <ID контейнера приложения> python manage.py loaddata [данные].json```
